!function(t){"use strict";t.paletteColorPicker=function(e,a){var s="palette-color-picker",i=t(e),n=this,o=i.val(),r=i.attr("name"),l=t("<div>").addClass(s+"-button").attr("data-target",r),c=t("<div>").addClass(s+"-bubble"),u={custom_class:null,colors:null,position:"upside",insert:"before",clear_btn:"first",timeout:2e3},d="ontouchstart"in document.documentElement?"touchstart":"click";n.init=function(){n.settings=t.extend({},u,a);var e=i.attr("value");if(void 0!==e&&!1!==e||(e="",i.attr("value",e)),i.attr("data-initialvalue",i.attr("value")),null===n.settings.colors&&(n.settings.colors=i.data("palette")),"string"==typeof n.settings.colors[0]&&(n.settings.colors=t.map(n.settings.colors,function(t,e){var a={};return a[t]=t,a})),n.settings.insert=n.settings.insert.charAt(0).toUpperCase()+n.settings.insert.slice(1),n.settings.custom_class&&c.addClass(n.settings.custom_class),t.each(n.settings.colors,function(e,a){var s=Object.keys(a)[0],i=a[s],n=t("<span>").addClass("swatch").attr({title:s,"data-color":i,"data-name":s}).css("background-color",i);s===o&&(n.addClass("active"),l.css("background",i)),n.appendTo(c)}),null!==n.settings.clear_btn){var r=t("<span>").addClass("swatch clear").attr("title","Clear selection");"last"===n.settings.clear_btn?r.addClass("last").appendTo(c):r.prependTo(c)}n.destroy=function(){l.remove(),t.removeData(i[0])},n.clear=function(){c.find(".active").removeClass("active"),l.removeAttr("style"),i.val("")},n.reset=function(){if(""===i.attr("data-initialvalue"))n.clear();else{var t=i.attr("data-initialvalue");c.find('[data-name="'+t+'"]').trigger("click")}},l.append(c).on(d,function(e){e.preventDefault(),e.stopPropagation();var a=t(this);t(event.target).hasClass(s+"-bubble")||(a.toggleClass("active").find("."+s+"-bubble").fadeToggle(),a.hasClass("active")&&(clearTimeout(n.timer),n.timer=setTimeout(function(){a.trigger("pcp.fadeout")},n.settings.timeout)))}).on("pcp.fadeout",function(){t(this).removeClass("active").find("."+s+"-bubble").fadeOut()}).on("mouseenter","."+s+"-bubble",function(){clearTimeout(n.timer)}).on("mouseleave","."+s+"-bubble",function(){n.timer=setTimeout(function(){l.trigger("pcp.fadeout")},n.settings.timeout)}).on(d,"span.swatch",function(e){e.preventDefault(),e.stopPropagation();var a=t(this).attr("data-color"),i=t(this).attr("data-name"),o=t("."+s+'-button[data-target="'+t(this).closest("."+s+"-button").attr("data-target")+'"]');t(this).closest("."+s+"-bubble").find(".active").removeClass("active"),t(e.target).is(".clear")?(o.removeAttr("style"),a=""):(t(this).addClass("active"),o.css("background",a)),t('[name="'+o.attr("data-target")+'"]').val(i),"function"==typeof n.settings.onchange_callback&&n.settings.onchange_callback()})["insert"+n.settings.insert](i),("downside"===n.settings.position||i.offset().top+20<c.outerHeight())&&c.addClass("downside")},t("body").on(d,function(e){t(e.target).hasClass(s+"-button")||t(l).removeClass("active").find("."+s+"-bubble").fadeOut()}),n.init()},t.fn.paletteColorPicker=function(e){return this.each(function(){void 0===t(this).data("paletteColorPickerPlugin")&&t(this).data("paletteColorPickerPlugin",new t.paletteColorPicker(this,e))})}}(jQuery);